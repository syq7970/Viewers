)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/components/flexboxLayout/flexboxLayout.js","meteor://ðŸ’»app/client/components/standaloneViewerMain/standaloneViewerMain.js","meteor://ðŸ’»app/client/components/toolbarSection/toolbarSection.js","meteor://ðŸ’»app/client/components/viewer/viewer.js","meteor://ðŸ’»app/client/config.js","meteor://ðŸ’»app/routes.js"],"names":["Template","module","watch","require","v","flexboxLayout","events","event","instance","target","classList","contains","window","ResizeViewportManager","handleResize","helpers","leftSidebarOpen","data","state","get","Meteor","OHIF","startup","viewerbase","standaloneViewerMain","onCreated","addEventListener","getResizeHandler","viewer","updateImageSynchronizer","cornerstoneTools","Synchronizer","metadataProvider","cornerstone","MetadataProvider","metaData","addProvider","provider","bind","onRendered","studies","parentElement","$","studyPrefetcher","StudyPrefetcher","getInstance","studyLoadingListener","StudyLoadingListener","clear","addStudies","layoutManager","LayoutManager","updateViewports","setStudies","hotkeyUtils","enableHotkeys","onDestroyed","removeEventListener","destroy","stackManager","clearStacks","toolbarSection","uiSettings","set","leftSidebarToggleButtonData","toggleable","key","value","options","svgLink","svgWidth","svgHeight","bottomLabel","toolbarButtons","extraTools","push","id","title","classes","iconClasses","buttonData","displayEchoUltrasoundWorkflow","isPlaying","viewportUtils","active","is","buttonTemplateName","subTools","hangingProtocolButtons","dropdown","states","toolManager","getToolDefaultStates","disabledToolButtons","allToolbarButtons","find","length","i","toolbarButton","prop","index","indexOf","attr","Session","Tracker","ReactiveDict","functionList","toggleCineDialog","toggleCinePlay","clearTools","resetViewport","invert","setDefault","initHangingProtocol","HP","ProtocolStore","onReady","studyMetadataList","StudyMetadataList","all","studyMetadataSource","OHIFStudyMetadataSource","ProtocolEngine","setEngine","loadedSeriesData","log","info","viewportColumns","viewportRows","activeViewport","setPersistent","Studies","removeAll","studyInstanceUids","forEach","studyMetadata","metadata","StudyMetadata","study","studyInstanceUid","displaySets","sortingManager","getDisplaySets","selected","insert","autorun","isOHIFViewerMainRendered","nonreactive","current","cornerstoneWADOImageLoader","maxWebWorkers","Math","max","navigator","hardwareConcurrency","config","startWebWorkersOnDemand","webWorkerPath","utils","absoluteUrl","taskConfiguration","decodeTask","loadCodecsOnStartup","initializeCodecsOnStartup","codecsPath","usePDFJS","webWorkerManager","initialize","Router","isClient","disconnect","configure","loadingTemplate","onBeforeAction","route","onRun","console","warn","query","params","url","next","idUrl","oReq","XMLHttpRequest","responseText","JSON","stringify","parse","open","setRequestHeader","send","action","render","isServer","where","RequestStudies","findOne","transactionId","response","setHeader","write","end"],"mappings":"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","file":"/app.js","sourcesContent":["import { Template } from 'meteor/templating';\n\nTemplate.flexboxLayout.events({\n    'transitionend .sidebarMenu'(event, instance) {\n        if (!event.target.classList.contains('sidebarMenu')) {\n            return;\n        }\n\n        window.ResizeViewportManager.handleResize();\n    }\n});\n\nTemplate.flexboxLayout.helpers({\n    leftSidebarOpen() {\n        return Template.instance().data.state.get('leftSidebar');\n    }\n});\n","import { Meteor } from 'meteor/meteor';\nimport { Template } from 'meteor/templating';\nimport { OHIF } from 'meteor/ohif:core';\nimport 'meteor/ohif:viewerbase';\n\nMeteor.startup(() => {\n    window.ResizeViewportManager = window.ResizeViewportManager || new OHIF.viewerbase.ResizeViewportManager();\n});\n\nTemplate.standaloneViewerMain.onCreated(() => {\n    // Attach the Window resize listener\n    window.addEventListener('resize', window.ResizeViewportManager.getResizeHandler());\n\n    // Create the synchronizer used to update reference lines\n    OHIF.viewer.updateImageSynchronizer = new cornerstoneTools.Synchronizer('cornerstonenewimage', cornerstoneTools.updateImageSynchronizer);\n\n    OHIF.viewer.metadataProvider = new OHIF.cornerstone.MetadataProvider();\n    // Metadata configuration\n    const metadataProvider = OHIF.viewer.metadataProvider;\n    cornerstone.metaData.addProvider(metadataProvider.provider.bind(metadataProvider));\n});\n\nTemplate.standaloneViewerMain.onRendered(() => {\n    const instance = Template.instance();\n\n    const studies = instance.data.studies;\n    const parentElement = instance.$('#layoutManagerTarget').get(0);\n    const studyPrefetcher = OHIF.viewerbase.StudyPrefetcher.getInstance();\n    instance.studyPrefetcher = studyPrefetcher;\n\n    instance.studyLoadingListener = OHIF.viewerbase.StudyLoadingListener.getInstance();\n    instance.studyLoadingListener.clear();\n    instance.studyLoadingListener.addStudies(studies);\n\n    OHIF.viewerbase.layoutManager = new OHIF.viewerbase.LayoutManager(parentElement, studies);\n    OHIF.viewerbase.layoutManager.updateViewports();\n\n    studyPrefetcher.setStudies(studies);\n\n    // Enable hotkeys\n    OHIF.viewerbase.hotkeyUtils.enableHotkeys();\n});\n\nTemplate.standaloneViewerMain.onDestroyed(() => {\n    // Remove the Window resize listener\n    window.removeEventListener('resize', window.ResizeViewportManager.getResizeHandler());\n\n    // Destroy the synchronizer used to update reference lines\n    OHIF.viewer.updateImageSynchronizer.destroy();\n\n    delete OHIF.viewerbase.layoutManager;\n\n    // Stop prefetching when we close the viewer\n    instance.studyPrefetcher.destroy();\n\n    // Destroy stack loading listeners when we close the viewer\n    instance.studyLoadingListener.clear();\n\n    // Clear references to all stacks in the StackManager\n    OHIF.viewerbase.stackManager.clearStacks();\n});\n","import { Template } from 'meteor/templating';\nimport { OHIF } from 'meteor/ohif:core';\nimport 'meteor/ohif:viewerbase';\n\nTemplate.toolbarSection.onCreated(() => {\n    const instance = Template.instance();\n\n    if (OHIF.uiSettings.leftSidebarOpen) {\n        instance.data.state.set('leftSidebar', 'studies');\n    }\n});\n\nTemplate.toolbarSection.helpers({\n    leftSidebarToggleButtonData() {\n        const instance = Template.instance();\n        return {\n            toggleable: true,\n            key: 'leftSidebar',\n            value: instance.data.state,\n            options: [{\n                value: 'studies',\n                svgLink: 'packages/ohif_viewerbase/assets/icons.svg#icon-studies',\n                svgWidth: 15,\n                svgHeight: 13,\n                bottomLabel: 'Series'\n            }]\n        };\n    },\n\n    toolbarButtons() {\n        const extraTools = [];\n\n        extraTools.push({\n            id: 'crosshairs',\n            title: 'Crosshairs',\n            classes: 'imageViewerTool',\n            iconClasses: 'fa fa-crosshairs'\n        });\n\n        extraTools.push({\n            id: 'stackScroll',\n            title: 'Stack Scroll',\n            classes: 'imageViewerTool',\n            iconClasses: 'fa fa-bars'\n        });\n\n        extraTools.push({\n            id: 'magnify',\n            title: 'Magnify',\n            classes: 'imageViewerTool toolbarSectionButton',\n            iconClasses: 'fa fa-circle'\n        });\n\n        extraTools.push({\n            id: 'wwwcRegion',\n            title: 'ROI Window',\n            classes: 'imageViewerTool',\n            iconClasses: 'fa fa-square'\n        });\n\n        extraTools.push({\n            id: 'dragProbe',\n            title: 'Probe',\n            classes: 'imageViewerTool',\n            iconClasses: 'fa fa-dot-circle-o'\n        });\n\n        extraTools.push({\n            id: 'ellipticalRoi',\n            title: 'Ellipse',\n            classes: 'imageViewerTool',\n            iconClasses: 'fa fa-circle-o'\n        });\n\n        extraTools.push({\n            id: 'rectangleRoi',\n            title: 'Rectangle',\n            classes: 'imageViewerTool',\n            iconClasses: 'fa fa-square-o'\n        });\n\n        extraTools.push({\n            id: 'invert',\n            title: 'Invert',\n            classes: 'imageViewerCommand',\n            iconClasses: 'fa fa-adjust'\n        });\n\n        extraTools.push({\n            id: 'rotateR',\n            title: 'Rotate Right',\n            classes: 'imageViewerCommand',\n            svgLink: '/packages/ohif_viewerbase/assets/icons.svg#icon-tools-rotate-right'\n        });\n\n        extraTools.push({\n            id: 'flipH',\n            title: 'Flip H',\n            classes: 'imageViewerCommand',\n            svgLink: '/packages/ohif_viewerbase/assets/icons.svg#icon-tools-flip-horizontal'\n        });\n\n        extraTools.push({\n            id: 'flipV',\n            title: 'Flip V',\n            classes: 'imageViewerCommand',\n            svgLink: '/packages/ohif_viewerbase/assets/icons.svg#icon-tools-flip-vertical'\n        });\n\n        extraTools.push({\n            id: 'clearTools',\n            title: 'Clear',\n            classes: 'imageViewerCommand',\n            iconClasses: 'fa fa-trash'\n        });\n\n        const buttonData = [];\n\n        buttonData.push({\n            id: 'zoom',\n            title: 'Zoom',\n            classes: 'imageViewerTool',\n            svgLink: 'packages/ohif_viewerbase/assets/icons.svg#icon-tools-zoom'\n        });\n\n        buttonData.push({\n            id: 'wwwc',\n            title: 'Levels',\n            classes: 'imageViewerTool',\n            svgLink: 'packages/ohif_viewerbase/assets/icons.svg#icon-tools-levels'\n        });\n\n        buttonData.push({\n            id: 'pan',\n            title: 'Pan',\n            classes: 'imageViewerTool',\n            svgLink: 'packages/ohif_viewerbase/assets/icons.svg#icon-tools-pan'\n        });\n\n        buttonData.push({\n            id: 'length',\n            title: 'Length',\n            classes: 'imageViewerTool toolbarSectionButton',\n            svgLink: 'packages/ohif_viewerbase/assets/icons.svg#icon-tools-measure-temp'\n        });\n\n        buttonData.push({\n            id: 'annotate',\n            title: 'Annotate',\n            classes: 'imageViewerTool',\n            svgLink: 'packages/ohif_viewerbase/assets/icons.svg#icon-tools-measure-non-target'\n        });\n\n        buttonData.push({\n            id: 'angle',\n            title: 'Angle',\n            classes: 'imageViewerTool',\n            iconClasses: 'fa fa-angle-left'\n        });\n\n        buttonData.push({\n            id: 'resetViewport',\n            title: 'Reset',\n            classes: 'imageViewerCommand',\n            iconClasses: 'fa fa-undo'\n        });\n\n        if (!OHIF.uiSettings.displayEchoUltrasoundWorkflow) {\n\n            buttonData.push({\n                id: 'previousDisplaySet',\n                title: 'Previous',\n                classes: 'imageViewerCommand',\n                iconClasses: 'fa fa-toggle-up fa-fw'\n            });\n\n            buttonData.push({\n                id: 'nextDisplaySet',\n                title: 'Next',\n                classes: 'imageViewerCommand',\n                iconClasses: 'fa fa-toggle-down fa-fw'\n            });\n\n            const { isPlaying } = OHIF.viewerbase.viewportUtils;\n            buttonData.push({\n                id: 'toggleCinePlay',\n                title: () => isPlaying() ? 'Stop' : 'Play',\n                classes: 'imageViewerCommand',\n                iconClasses: () => ('fa fa-fw ' + (isPlaying() ? 'fa-stop' : 'fa-play')),\n                active: isPlaying\n            });\n\n            buttonData.push({\n                id: 'toggleCineDialog',\n                title: 'CINE',\n                classes: 'imageViewerCommand',\n                iconClasses: 'fa fa-youtube-play',\n                active: () => $('#cineDialog').is(':visible')\n            });\n        }\n\n        buttonData.push({\n            id: 'layout',\n            title: 'Layout',\n            iconClasses: 'fa fa-th-large',\n            buttonTemplateName: 'layoutButton'\n        });\n\n        buttonData.push({\n            id: 'toggleMore',\n            title: 'More',\n            classes: 'rp-x-1 rm-l-3',\n            svgLink: 'packages/ohif_viewerbase/assets/icons.svg#icon-tools-more',\n            subTools: extraTools\n        });\n\n        return buttonData;\n    },\n\n    hangingProtocolButtons() {\n        let buttonData = [];\n\n        buttonData.push({\n            id: 'previousPresentationGroup',\n            title: 'Prev. Stage',\n            iconClasses: 'fa fa-step-backward',\n            buttonTemplateName: 'previousPresentationGroupButton'\n        });\n\n        buttonData.push({\n            id: 'nextPresentationGroup',\n            title: 'Next Stage',\n            iconClasses: 'fa fa-step-forward',\n            buttonTemplateName: 'nextPresentationGroupButton'\n        });\n\n        return buttonData;\n    }\n\n});\n\nTemplate.toolbarSection.onRendered(function() {\n    const instance = Template.instance();\n\n    instance.$('#layout').dropdown();\n\n    // Set disabled/enabled tool buttons that are set in toolManager\n    const states = OHIF.viewerbase.toolManager.getToolDefaultStates();\n    const disabledToolButtons = states.disabledToolButtons;\n    const allToolbarButtons = $('#toolbar').find('button');\n    if (disabledToolButtons && disabledToolButtons.length > 0) {\n        for (let i = 0; i < allToolbarButtons.length; i++) {\n            const toolbarButton = allToolbarButtons[i];\n            $(toolbarButton).prop('disabled', false);\n\n            const index = disabledToolButtons.indexOf($(toolbarButton).attr('id'));\n            if (index !== -1) {\n                $(toolbarButton).prop('disabled', true);\n            }\n        }\n    }\n});\n","import { Template } from 'meteor/templating';\nimport { Session } from 'meteor/session';\nimport { Tracker } from 'meteor/tracker';\nimport { ReactiveDict } from 'meteor/reactive-dict';\nimport { OHIF } from 'meteor/ohif:core';\nimport 'meteor/ohif:viewerbase';\nimport 'meteor/ohif:metadata';\n\nconst viewportUtils = OHIF.viewerbase.viewportUtils;\n\nOHIF.viewer.functionList = {\n    toggleCineDialog: viewportUtils.toggleCineDialog,\n    toggleCinePlay: viewportUtils.toggleCinePlay,\n    clearTools: viewportUtils.clearTools,\n    resetViewport: viewportUtils.resetViewport,\n    invert: viewportUtils.invert\n};\n\nSession.setDefault('activeViewport', false);\nSession.setDefault('leftSidebar', false);\nSession.setDefault('rightSidebar', false);\n\n/**\n * Inits OHIF Hanging Protocol's onReady.\n * It waits for OHIF Hanging Protocol to be ready to instantiate the ProtocolEngine\n * Hanging Protocol will use OHIF LayoutManager to render viewports properly\n */\nconst initHangingProtocol = () => {\n    // When Hanging Protocol is ready\n    HP.ProtocolStore.onReady(() => {\n\n        // Gets all StudyMetadata objects: necessary for Hanging Protocol to access study metadata\n        const studyMetadataList = OHIF.viewer.StudyMetadataList.all();\n\n        // Caches Layout Manager: Hanging Protocol uses it for layout management according to current protocol\n        const layoutManager = OHIF.viewerbase.layoutManager;\n\n        // Instantiate StudyMetadataSource: necessary for Hanging Protocol to get study metadata\n        const studyMetadataSource = new OHIF.studies.classes.OHIFStudyMetadataSource();\n\n        // Creates Protocol Engine object with required arguments\n        const ProtocolEngine = new HP.ProtocolEngine(layoutManager, studyMetadataList, [], studyMetadataSource);\n\n        // Sets up Hanging Protocol engine\n        HP.setEngine(ProtocolEngine);\n\n    });\n};\n\nTemplate.viewer.onCreated(() => {\n    const instance = Template.instance();\n\n    instance.state = new ReactiveDict();\n\n    instance.state.set('leftSidebar', Session.get('leftSidebar'));\n    instance.state.set('rightSidebar', Session.get('rightSidebar'));\n\n    if (OHIF.viewer.data && OHIF.viewer.data.loadedSeriesData) {\n        OHIF.log.info('Reloading previous loadedSeriesData');\n        OHIF.viewer.loadedSeriesData = OHIF.viewer.data.loadedSeriesData;\n    } else {\n        OHIF.log.info('Setting default viewer data');\n        OHIF.viewer.loadedSeriesData = {};\n        OHIF.viewer.data = {};\n        OHIF.viewer.data.loadedSeriesData = OHIF.viewer.loadedSeriesData;\n\n        // Update the viewer data object\n        OHIF.viewer.data.viewportColumns = 1;\n        OHIF.viewer.data.viewportRows = 1;\n        OHIF.viewer.data.activeViewport = 0;\n    }\n\n    // Store the viewer data in session for further user\n    Session.setPersistent('ViewerData', OHIF.viewer.data);\n\n    Session.set('activeViewport', OHIF.viewer.data.activeViewport || 0);\n\n    // @TypeSafeStudies\n    // Update the OHIF.viewer.Studies collection with the loaded studies\n    OHIF.viewer.Studies.removeAll();\n\n    // @TypeSafeStudies\n    // Clears OHIF.viewer.StudyMetadataList collection\n    OHIF.viewer.StudyMetadataList.removeAll();\n\n    OHIF.viewer.data.studyInstanceUids = [];\n    instance.data.studies.forEach(study => {\n        const studyMetadata = new OHIF.metadata.StudyMetadata(study, study.studyInstanceUid);\n        let displaySets = study.displaySets;\n\n        if(!study.displaySets) {\n            displaySets = OHIF.viewerbase.sortingManager.getDisplaySets(studyMetadata);\n            study.displaySets = displaySets;\n        }\n\n        study.selected = true;\n        OHIF.viewer.Studies.insert(study);\n        OHIF.viewer.StudyMetadataList.insert(studyMetadata);\n        OHIF.viewer.data.studyInstanceUids.push(study.studyInstanceUid);\n    });\n});\n\nTemplate.viewer.onRendered(function() {\n\n    this.autorun(function() {\n        // To make sure ohif viewerMain is rendered before initializing Hanging Protocols\n        const isOHIFViewerMainRendered = Session.get('OHIFViewerMainRendered');\n\n        // To avoid first run\n        if (isOHIFViewerMainRendered) {\n            // To run only when ViewerMainRendered dependency has changed.\n            // because initHangingProtocol can have other reactive components\n            Tracker.nonreactive(initHangingProtocol);\n        }\n    });\n\n});\n\nTemplate.viewer.events({\n    'click .js-toggle-studies'() {\n        const instance = Template.instance();\n        const current = instance.state.get('leftSidebar');\n        instance.state.set('leftSidebar', !current);\n    }\n});\n\nTemplate.viewer.helpers({\n    state() {\n        return Template.instance().state;\n    }\n});\n","import { Meteor } from 'meteor/meteor';\nimport { OHIF } from 'meteor/ohif:core';\nimport { cornerstoneWADOImageLoader } from 'meteor/ohif:cornerstone';\n\nMeteor.startup(function() {\n    const maxWebWorkers = Math.max(navigator.hardwareConcurrency - 1, 1);\n    const config = {\n        maxWebWorkers: maxWebWorkers,\n        startWebWorkersOnDemand: true,\n        webWorkerPath: OHIF.utils.absoluteUrl('packages/ohif_cornerstone/public/js/cornerstoneWADOImageLoaderWebWorker.es5.js'),\n        taskConfiguration: {\n            decodeTask: {\n                loadCodecsOnStartup: true,\n                initializeCodecsOnStartup: false,\n                codecsPath: OHIF.utils.absoluteUrl('packages/ohif_cornerstone/public/js/cornerstoneWADOImageLoaderCodecs.es5.js'),\n                usePDFJS: false\n            }\n        }\n    };\n\n    cornerstoneWADOImageLoader.webWorkerManager.initialize(config);\n});\n","import { Meteor } from 'meteor/meteor';\nimport { Router } from 'meteor/iron:router';\nimport { OHIF } from 'meteor/ohif:core';\n\nif (Meteor.isClient) {\n    // Disconnect from the Meteor Server since we don't need it\n    OHIF.log.info('Disconnecting from the Meteor server');\n    Meteor.disconnect();\n\n    Router.configure({\n        loadingTemplate: 'loading'\n    });\n\n    Router.onBeforeAction('loading');\n\n    Router.route('/:id?', {\n        onRun: function() {\n            console.warn('onRun');\n            // Retrieve the query from the URL the user has entered\n            const query = this.params.query;\n            const id = this.params.id;\n\n            if (!id && !query.url) {\n                console.log('No URL was specified. Use ?url=${yourURL}');\n                return;\n            }\n\n            const next = this.next;\n            const idUrl = `/api/${id}`;\n            const url = query.url || idUrl;\n\n            // Define a request to the server to retrieve the study data\n            // as JSON, given a URL that was in the Route\n            const oReq = new XMLHttpRequest();\n\n            // Add event listeners for request failure\n            oReq.addEventListener('error', () => {\n                OHIF.log.warn('An error occurred while retrieving the JSON data');\n                next();\n            });\n\n            // When the JSON has been returned, parse it into a JavaScript Object\n            // and render the OHIF Viewer with this data\n            oReq.addEventListener('load', () => {\n                // Parse the response content\n                // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseText\n                if (!oReq.responseText) {\n                    OHIF.log.warn('Response was undefined');\n                    return;\n                }\n\n                OHIF.log.info(JSON.stringify(oReq.responseText, null, 2));\n                this.data = JSON.parse(oReq.responseText);\n\n                next();\n            });\n\n            // Open the Request to the server for the JSON data\n            // In this case we have a server-side route called /api/\n            // which responds to GET requests with the study data\n            OHIF.log.info(`Sending Request to: ${url}`);\n            oReq.open('GET', url);\n            oReq.setRequestHeader('Accept', 'application/json')\n\n            // Fire the request to the server\n            oReq.send();\n        },\n        action() {\n            // Render the Viewer with this data\n            this.render('standaloneViewer', {\n                data: () => this.data\n            });\n        }\n    });\n}\n\n// This is ONLY for demo purposes.\nif (Meteor.isServer) {\n    // You can test this with:\n    // curl -v -H \"Content-Type: application/json\" -X GET 'http://localhost:3000/getData/testId'\n    //\n    // Or by going to:\n    // http://localhost:3000/api/testId\n\n    Router.route('/api/:id', { where: 'server' }).get(function() {\n        // \"this\" is the RouteController instance.\n        // \"this.response\" is the Connect response object\n        // \"this.request\" is the Connect request object\n        const id = this.params.id;\n\n        // Find the relevant study data from the Collection given the ID\n        const data = RequestStudies.findOne({ transactionId: id });\n\n        // Set the response headers to return JSON to any server\n        this.response.setHeader('Content-Type', 'application/json');\n        this.response.setHeader('Access-Control-Allow-Origin', '*');\n        this.response.setHeader('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Accept');\n\n        // Change the response text depending on the available study data\n        if (!data) {\n            this.response.write('No Data Found');\n        } else {\n            // Stringify the JavaScript object to JSON for the response\n            this.response.write(JSON.stringify(data));\n        }\n\n        // Finalize the response\n        this.response.end();\n    });\n}\n"]}