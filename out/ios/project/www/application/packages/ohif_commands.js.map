)]}'
{"version":3,"sources":["meteor://ðŸ’»app/packages/ohif:commands/main.js","meteor://ðŸ’»app/packages/ohif:commands/client/classes/CommandsManager.js"],"names":["module","export","context","commands","ReactiveVar","watch","require","v","OHIF","CommandsManager","_","contexts","last","getContext","contextName","log","warn","getCurrentContext","get","createContext","clear","set","definitions","extend","Object","keys","forEach","command","register","definition","setDisabledFunction","func","disabled","getDefinition","isDisabled","isFunction","run","action","params","result","dep","changed"],"mappings":"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","file":"/packages/ohif_commands.js","sourcesContent":["import { ReactiveVar } from 'meteor/reactive-var';\nimport { OHIF } from 'meteor/ohif:core';\nimport { CommandsManager } from 'meteor/ohif:commands/client/classes/CommandsManager';\n\n// Create context namespace using a ReactiveVar\nconst context = new ReactiveVar(null);\n\n// Append context namespace to OHIF namespace\nOHIF.context = context;\n\n// Create commands namespace using a CommandsManager class instance\nconst commands = new CommandsManager(context);\n\n// Append commands namespace to OHIF namespace\nOHIF.commands = commands;\n\n// Export relevant objects\nexport { context, commands };\n","import { ReactiveVar } from 'meteor/reactive-var';\nimport { _ } from 'meteor/underscore';\nimport { OHIF } from 'meteor/ohif:core';\n\nexport class CommandsManager {\n    constructor() {\n        this.contexts = {};\n\n        // Enable reactivity by storing the last executed command\n        this.last = new ReactiveVar('');\n    }\n\n    getContext(contextName) {\n        const context = this.contexts[contextName];\n        if (!context) {\n            return OHIF.log.warn(`No context found with name \"${contextName}\"`);\n        }\n\n        return context;\n    }\n\n    getCurrentContext() {\n        const contextName = OHIF.context.get();\n        if (!contextName) {\n            return OHIF.log.warn('There is no selected context');\n        }\n\n        return this.getContext(contextName);\n    }\n\n    createContext(contextName) {\n        if (!contextName) return;\n        if (this.contexts[contextName]) {\n            return this.clear(contextName);\n        }\n\n        this.contexts[contextName] = {};\n    }\n\n    set(contextName, definitions, extend=false) {\n        if (typeof definitions !== 'object') return;\n        const context = this.getContext(contextName);\n        if (!context) return;\n\n        if (!extend) {\n            this.clear(contextName);\n        }\n\n        Object.keys(definitions).forEach(command => (context[command] = definitions[command]));\n    }\n\n    register(contextName, command, definition) {\n        if (typeof definition !== 'object') return;\n        const context = this.getContext(contextName);\n        if (!context) return;\n\n        context[command] = definition;\n    }\n\n    setDisabledFunction(contextName, command, func) {\n        if (!command || typeof func !== 'function') return;\n        const context = this.getContext(contextName);\n        if (!context) return;\n        const definition = context[command];\n        if (!definition) {\n            return OHIF.log.warn(`Trying to set a disabled function to a command \"${command}\" that was not yet defined`);\n        }\n\n        definition.disabled = func;\n    }\n\n    clear(contextName) {\n        if (!contextName) return;\n        this.contexts[contextName] = {};\n    }\n\n    getDefinition(command) {\n        const context = this.getCurrentContext();\n        if (!context) return;\n        return context[command];\n    }\n\n    isDisabled(command) {\n        const definition = this.getDefinition(command);\n        if (!definition) return false;\n        const { disabled } = definition;\n        if (_.isFunction(disabled) && disabled()) return true;\n        if (!_.isFunction(disabled) && disabled) return true;\n        return false;\n    }\n\n    run(command) {\n        const definition = this.getDefinition(command);\n        if (!definition) {\n            return OHIF.log.warn(`Command \"${command}\" not found in current context`);\n        }\n\n        const { action, params } = definition;\n        if (this.isDisabled(command)) return;\n        if (typeof action !== 'function') {\n            return OHIF.log.warn(`No action was defined for command \"${command}\"`);\n        } else {\n            const result = action(params);\n            if (this.last.get() === command) {\n                this.last.dep.changed();\n            } else {\n                this.last.set(command);\n            }\n\n            return result;\n        }\n    }\n}\n"]}